<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- Actor data for JavaScript -->
    <script type="application/json" id="actorOptionsData">/*[[${#jackson.writeValueAsString(actors)}]]*/</script>
</head>
<body>
    <div th:fragment="content" class="cinema-stage">
        <!-- Cinema-themed Movie Reel -->
        <div class="movie-reel">
            üé¨
        </div>
        
        <!-- Dashboard Content Wrapper -->
        <div class="dashboard-content">
            <!-- Add Movie Button -->
            <button type="button" class="btn-add-movie" data-toggle="modal" data-target="#movieModal" id="addMovieBtn">
                <i class="fa fa-plus-circle"></i> Th√™m Phim M·ªõi
            </button>

            <!-- Movie Management Header -->
            <div class="movie-management-header">
                <h1>
                    <i class="fa fa-film"></i>
                    H·ªá Th·ªëng Qu·∫£n L√Ω Phim
                </h1>
            </div>

            <!-- Filter Section -->
            <div class="filter-section" style="margin-bottom: 20px;">
                <div class="row">
                    <div class="col-md-3">
                        <label for="statusFilter" style="color: #000000; margin-bottom: 5px;">L·ªçc theo Tr·∫°ng th√°i:</label>
                        <select class="form-control" id="statusFilter" onchange="filterMoviesByStatus()">
                            <option value="all">T·∫•t c·∫£ Phim</option>
                            <option value="showing">ƒêang Chi·∫øu</option>
                            <option value="not-showing">Ng·ª´ng Chi·∫øu</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Movie Table Container -->
            <div class="movie-table-container">
                <table class="table movie-table">
                    <thead>
                        <tr>
                            <th>Poster</th>
                            <th>T√™n Phim</th>
                            <th>ƒê·∫°o Di·ªÖn</th>
                            <th>Th·ªùi L∆∞·ª£ng</th>
                            <th>Th·ªÉ Lo·∫°i</th>
                            <th>Ng√¥n Ng·ªØ</th>
                            <th>Tr·∫°ng Th√°i</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="movie : ${movies}">
                            <td>
                                <img th:src="${movie.smallImageUrl != null ? movie.smallImageUrl : '/images/default-movie.jpg'}" 
                                     alt="Poster Phim" class="movie-poster" />
                            </td>
                            <td>
                                <strong th:text="${movie.name}">T√™n Phim</strong>
                                <br>
                                <small class="text-muted" th:text="${movie.rating != null ? movie.rating.name : movie.rated}">PG-13</small>
                            </td>
                            <td>
                                <span class="director-badge" th:if="${movie.director != null}" th:text="${movie.director.name}">ƒê·∫°o Di·ªÖn</span>
                                <span class="text-muted" th:if="${movie.director == null}">Ch∆∞a c√≥ ƒê·∫°o Di·ªÖn</span>
                            </td>
                            <td th:text="${movie.duration + ' ph√∫t'}">120 ph√∫t</td>
                            <td th:text="${movie.categories}">H√†nh ƒê·ªông, Ch√≠nh K·ªãch</td>
                            <td th:text="${movie.language}">Ti·∫øng Anh</td>
                            <td>
                                <span class="status-badge" 
                                      th:classappend="${movie.isShowing == 1 ? 'status-showing' : 'status-not-showing'}"
                                      th:text="${movie.isShowing == 1 ? 'ƒêang Chi·∫øu' : 'Ng·ª´ng Chi·∫øu'}">
                                    ƒêang Chi·∫øu
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="btn-action btn-edit" 
                                            th:data-movie-id="${movie.id}"
                                            onclick="editMovie(this.dataset.movieId)">
                                        <i class="fa fa-edit"></i> S·ª≠a
                                    </button>
                                    <button type="button" class="btn-action btn-delete" 
                                            th:data-movie-id="${movie.id}"
                                            th:data-movie-name="${movie.name}"
                                            onclick="deleteMovie(this.dataset.movieId, this.dataset.movieName)">
                                        <i class="fa fa-trash"></i> X√≥a
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Movie Modal -->
    <div class="modal fade" id="movieModal" tabindex="-1" role="dialog" aria-labelledby="movieModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="movieModalLabel">
                        <i class="fa fa-film"></i> Th√™m Phim M·ªõi
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 0.8;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="movieForm">
                        <input type="hidden" id="movieId" name="movieId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="movieName">T√™n Phim * <small class="text-muted">(t·ªëi ƒëa 255 k√Ω t·ª±)</small></label>
                                    <input type="text" class="form-control" id="movieName" name="name" maxlength="255" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="movieDuration">Th·ªùi L∆∞·ª£ng (ph√∫t) *</label>
                                    <input type="number" class="form-control" id="movieDuration" name="duration" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="movieCategories">Th·ªÉ Lo·∫°i * <small class="text-muted">(t·ªëi ƒëa 100 k√Ω t·ª±)</small></label>
                                    <input type="text" class="form-control" id="movieCategories" name="categories" 
                                           placeholder="v√≠ d·ª•: H√†nh ƒê·ªông, Ch√≠nh K·ªãch, H√†i K·ªãch" maxlength="100" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="movieLanguage">Ng√¥n Ng·ªØ *</label>
                                    <select class="form-control" id="movieLanguage" name="language" required>
                                        <option value="">Ch·ªçn Ng√¥n Ng·ªØ</option>
                                        <option value="Vietnamese Subtitles">Ph·ª• ƒê·ªÅ Ti·∫øng Vi·ªát</option>
                                        <option value="Vietnamese Dubbed">L·ªìng Ti·∫øng Vi·ªát</option>
                                        <option value="English Subtitles">Ph·ª• ƒê·ªÅ Ti·∫øng Anh</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="movieRated">X·∫øp H·∫°ng</label>
                                    <select class="form-control" id="movieRated" name="ratingId">
                                        <option value="">Ch·ªçn X·∫øp H·∫°ng</option>
                                        <option th:each="rating : ${ratings}" th:value="${rating.id}" th:text="${rating.name + ' - ' + rating.description}">X·∫øp H·∫°ng</option>
                                    </select>
                                    <button type="button" class="btn btn-sm btn-success" style="margin-top: 5px;" onclick="openAddRatingModal()">
                                        <i class="fa fa-plus"></i> Th√™m X·∫øp H·∫°ng M·ªõi
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="movieFormat">ƒê·ªãnh D·∫°ng</label>
                                    <select class="form-control" id="movieFormat" name="format">
                                        <option value="">Ch·ªçn ƒê·ªãnh D·∫°ng</option>
                                        <option value="2D">2D</option>
                                        <option value="3D">3D</option>
                                        <option value="IMAX">IMAX</option>
                                        <option value="4DX">4DX</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="movieStatus">Tr·∫°ng Th√°i</label>
                                    <select class="form-control" id="movieStatus" name="isShowing">
                                        <option value="1">ƒêang Chi·∫øu</option>
                                        <option value="0">Ng·ª´ng Chi·∫øu</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="movieDirector">ƒê·∫°o Di·ªÖn</label>
                            <select class="form-control" id="movieDirector" name="directorId">
                                <option value="">Ch·ªçn ƒê·∫°o Di·ªÖn</option>
                                <option th:each="director : ${directors}" th:value="${director.id}" th:text="${director.name}">T√™n ƒê·∫°o Di·ªÖn</option>
                            </select>
                            <button type="button" class="btn btn-sm btn-success" style="margin-top: 5px;" onclick="openAddDirectorModal()">
                                <i class="fa fa-plus"></i> Th√™m ƒê·∫°o Di·ªÖn M·ªõi
                            </button>
                        </div>

                        <!-- Media Upload Section -->
                        <div class="media-upload-section">
                            <h5 class="section-title">
                                <i class="fa fa-image"></i> H√¨nh ·∫¢nh Phim
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="movieSmallImage">H√¨nh Poster (Nh·ªè)</label>
                                        <div class="file-upload-container">
                                            <div class="file-upload-area" id="smallImageUploadArea">
                                                <div class="upload-icon">
                                                    <i class="fa fa-image"></i>
                                                </div>
                                                <div class="upload-text">
                                                    <span class="upload-title">Th·∫£ h√¨nh ·∫£nh v√†o ƒë√¢y ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn</span>
                                                    <span class="upload-subtitle">PNG, JPG, GIF t·ªëi ƒëa 10MB</span>
                                                </div>
                                                <input type="file" class="file-input" id="movieSmallImage" 
                                                       name="smallImageFile" accept="image/*">
                                            </div>
                                            <div class="file-preview" id="smallImagePreview" style="display: none;">
                                                <img class="preview-image" alt="Xem Tr∆∞·ªõc H√¨nh Nh·ªè">
                                                <div class="preview-overlay">
                                                    <button type="button" class="btn-remove-file" 
                                                            onclick="removeFilePreview('smallImage')">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="file-info">
                                                    <span class="file-name"></span>
                                                    <span class="file-size"></span>
                                                </div>
                                                <input type="hidden" name="smallImageUrl" data-current-image="smallImage">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="movieLargeImage">H√¨nh Banner (L·ªõn)</label>
                                        <div class="file-upload-container">
                                            <div class="file-upload-area" id="largeImageUploadArea">
                                                <div class="upload-icon">
                                                    <i class="fa fa-image"></i>
                                                </div>
                                                <div class="upload-text">
                                                    <span class="upload-title">Th·∫£ h√¨nh ·∫£nh v√†o ƒë√¢y ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn</span>
                                                    <span class="upload-subtitle">PNG, JPG, GIF t·ªëi ƒëa 10MB</span>
                                                </div>
                                                <input type="file" class="file-input" id="movieLargeImage" 
                                                       name="largeImageFile" accept="image/*">
                                            </div>
                                            <div class="file-preview" id="largeImagePreview" style="display: none;">
                                                <img class="preview-image" alt="Xem Tr∆∞·ªõc H√¨nh L·ªõn">
                                                <div class="preview-overlay">
                                                    <button type="button" class="btn-remove-file" 
                                                            onclick="removeFilePreview('largeImage')">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="file-info">
                                                    <span class="file-name"></span>
                                                    <span class="file-size"></span>
                                                </div>
                                                <input type="hidden" name="largeImageUrl" data-current-image="largeImage">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Trailer Section -->
                            <div class="trailer-section">
                                <div class="form-group">
                                    <label>URL Trailer (YouTube)</label>
                                    <div id="trailerYoutubeContainer">
                                        <input type="text" class="form-control" id="trailerYoutubeUrl" 
                                               name="trailerUrl" placeholder="Nh·∫≠p URL YouTube"
                                               maxlength="1000">
                                        <small class="form-text text-muted">
                                            <i class="fa fa-info-circle"></i> 
                                            Nh·∫≠p URL YouTube ƒë·∫ßy ƒë·ªß (v√≠ d·ª•: https://www.youtube.com/watch?v=...)
                                        </small>
                                        <div id="youtubePreview" class="mt-3"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="movieShortDescription">M√¥ T·∫£ Ng·∫Øn <small class="text-muted">(t·ªëi ƒëa 500 k√Ω t·ª±)</small></label>
                            <textarea class="form-control" id="movieShortDescription" name="shortDescription" rows="2" maxlength="500"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="movieLongDescription">M√¥ T·∫£ Chi Ti·∫øt <small class="text-muted">(t·ªëi ƒëa 1000 k√Ω t·ª±)</small></label>
                            <textarea class="form-control" id="movieLongDescription" name="longDescription" rows="4" maxlength="1000"></textarea>
                        </div>

                        <!-- Actors Section -->
                        <div class="form-group">
                            <label>Di·ªÖn Vi√™n & Nh√¢n V·∫≠t</label>
                            <div id="actorsContainer">
                                <!-- C√°c h√†ng di·ªÖn vi√™n s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y m·ªôt c√°ch ƒë·ªông -->
                            </div>
                            <button type="button" class="btn-add-actor" onclick="addActorRow()">
                                <i class="fa fa-plus"></i> Th√™m Di·ªÖn Vi√™n
                            </button>
                            <button type="button" class="btn btn-sm btn-info" style="margin-left: 10px;" data-toggle="modal" data-target="#actorModal">
                                <i class="fa fa-user-plus"></i> T·∫°o Di·ªÖn Vi√™n M·ªõi
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn-save-movie" onclick="saveMovie()">L∆∞u Phim</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Director Modal -->
    <div class="modal fade" id="directorModal" tabindex="-1" role="dialog" aria-labelledby="directorModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="directorModalLabel">
                        <i class="fa fa-user-plus"></i> Th√™m ƒê·∫°o Di·ªÖn M·ªõi
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 0.8;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="directorForm">
                        <div class="form-group">
                            <label for="directorName">T√™n ƒê·∫°o Di·ªÖn * <small class="text-muted">(t·ªëi ƒëa 255 k√Ω t·ª±)</small></label>
                            <input type="text" class="form-control" id="directorName" name="name" maxlength="255" required>
                        </div>
                        <div class="form-group">
                            <label for="directorBio">M√¥ T·∫£ <small class="text-muted">(t·ªëi ƒëa 255 k√Ω t·ª±)</small></label>
                            <textarea class="form-control" id="directorBio" name="biography" rows="3" maxlength="255" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ ƒë·∫°o di·ªÖn"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" onclick="saveDirector()">L∆∞u ƒê·∫°o Di·ªÖn</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Actor Modal -->
    <div class="modal fade" id="actorModal" tabindex="-1" role="dialog" aria-labelledby="actorModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="actorModalLabel">
                        <i class="fa fa-user-plus"></i> Th√™m Di·ªÖn Vi√™n M·ªõi
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 0.8;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="actorForm">
                        <div class="form-group">
                            <label for="actorName">T√™n Di·ªÖn Vi√™n * <small class="text-muted">(t·ªëi ƒëa 255 k√Ω t·ª±)</small></label>
                            <input type="text" class="form-control" id="actorName" name="name" maxlength="255" required>
                        </div> 
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" onclick="saveActor()">L∆∞u Di·ªÖn Vi√™n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div class="modal fade" id="ratingModal" tabindex="-1" role="dialog" aria-labelledby="ratingModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="ratingModalLabel">
                        <i class="fa fa-star-o"></i> Th√™m X·∫øp H·∫°ng M·ªõi
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 0.8;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="ratingForm">
                        <div class="form-group">
                            <label for="ratingName">T√™n X·∫øp H·∫°ng * <small class="text-muted">(t·ªëi ƒëa 50 k√Ω t·ª±)</small></label>
                            <input type="text" class="form-control" id="ratingName" name="name" maxlength="50" required placeholder="v√≠ d·ª•: PG-13, R, G">
                        </div>
                        <div class="form-group">
                            <label for="ratingDescription">M√¥ T·∫£ <small class="text-muted">(t·ªëi ƒëa 255 k√Ω t·ª±)</small></label>
                            <textarea class="form-control" id="ratingDescription" name="description" rows="3" maxlength="255" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ x·∫øp h·∫°ng"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="ratingAgeLimit">Gi·ªõi H·∫°n Tu·ªïi <small class="text-muted">(t√πy ch·ªçn)</small></label>
                            <input type="number" class="form-control" id="ratingAgeLimit" name="ageLimit" min="0" max="25" placeholder="Tu·ªïi t·ªëi thi·ªÉu y√™u c·∫ßu (t√πy ch·ªçn)">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" onclick="saveRating()">L∆∞u X·∫øp H·∫°ng</button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>

    </script>
</body>
</html> 