<!DOCTYPE html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movie-Details</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description" content="Movie Pro" />
    <meta name="keywords" content="Movie Pro" />
    <meta name="author" content="" />
    <meta name="MobileOptimized" content="320" />
    <!-- Template styles -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/animate.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/fonts.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/flaticon.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/owl.carousel.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/owl.theme.default.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/dl-menu.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/nice-select.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/magnific-popup.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/venobox.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/js/plugin/rs_slider/layers.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/js/plugin/rs_slider/navigation.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/js/plugin/rs_slider/settings.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/responsive.css}" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" th:href="@{/images/header/favicon.ico}" />
</head>
<body>
<!-- Preloader Start -->
<div id="preloader">
    <div id="status">
        <img th:src="@{/images/header/horoscope.gif}" id="preloader_image" alt="loader" />
    </div>
</div>
<!-- Navigation Start -->
<header lang="vi" th:replace="fragments/navigation :: navigation"></header>
<!-- Navigation End -->

<!-- Slider Start -->
<header lang="vi" th:replace="fragments/slider :: slider"></header>
<!-- Slider End -->

<!-- Title Wrapper Start -->
<div class="prs_title_main_sec_wrapper">
    <div class="prs_title_img_overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="prs_title_heading_wrapper">
                    <h2>Th·ªÉ lo·∫°i phim</h2>
                    <ul>
                        <li><a th:href="@{/}">Home</a></li>
                        <li> > Movie Category</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Title Wrapper End -->
<div class="container">
    <h1 th:text="${movie.name}">T√™n phim</h1>
    <img th:src="${movie.smallImageUrl}" alt="Poster" style="width: 300px; height: auto;" />
    <p><strong>Th·ªÉ lo·∫°i:</strong> <span th:text="${movie.categories}">Th·ªÉ lo·∫°i</span></p>
    <p><strong>Th·ªùi l∆∞·ª£ng:</strong> <span th:text="${movie.duration + ' minutes'}">Th·ªùi l∆∞·ª£ng</span></p>
    <p><strong>Kh·ªüi chi·∫øu:</strong> <span th:text="${#temporals.format(movie.releaseDate, 'yyyy-MM-dd')}">Ng√†y kh·ªüi chi·∫øu</span></p>
    <!-- N√∫t y√™u th√≠ch -->
    <form th:action="@{/favorite/toggle}" method="post" style="display: inline;">
        <input type="hidden" name="movieId" th:value="${movie.id}" />
        <button type="submit" style="background: none; border: none;">
            <i class="fa" th:classappend="${isFavorite} ? ' fa-heart text-danger' : ' fa-heart-o'"></i>
        </button>
    </form>

    <p><strong>T√≥m t·∫Øt:</strong> <span th:text="${movie.longDescription}">T√≥m t·∫Øt</span></p>
    <h3>B√¨nh lu·∫≠n</h3>
    <div th:if="${comments != null and #lists.isEmpty(comments)}">
        <p>Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
    </div>

    <!-- N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p -->
    <div th:if="${session.userLogin == null}">
        <p>Vui l√≤ng <a th:href="@{/login}">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ b√¨nh lu·∫≠n.</p>
    </div>

    <!-- N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p nh∆∞ng ch∆∞a xem phim -->
    <div th:if="${session.userLogin != null and !hasOrdered}">
        <p style="color: red;">B·∫°n c·∫ßn xem phim tr∆∞·ªõc khi ƒë√°nh gi√° b·ªô phim nh√©.</p>
    </div>

    <!-- N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p v√† ƒë√£ xem phim -->
    <div th:if="${session.userLogin != null and hasOrdered}">
        <form th:action="@{/addComment}" method="post">
            <input type="hidden" name="movieId" th:value="${movie.id}" />
            <label for="content">Vi·∫øt b√¨nh lu·∫≠n:</label><br />
            <textarea name="content" id="content" rows="4" cols="50" required></textarea><br />
            <button type="submit">G·ª≠i b√¨nh lu·∫≠n</button>
        </form>
    </div>


    <!-- V√≤ng l·∫∑p b√¨nh lu·∫≠n ch√≠nh -->
    <div th:each="comment : ${comments}" style="border: 1px solid #ddd; margin-bottom: 15px; padding: 10px;">
        <p><strong th:text="${comment.user.fullname}">Ng∆∞·ªùi d√πng</strong> ƒë√£ b√¨nh lu·∫≠n:</p>
        <p th:text="${comment.content}">N·ªôi dung</p>
        <p><i>Th·ªùi gian:</i> <span th:text="${#temporals.format(comment.createdAt, 'dd/MM/yyyy HH:mm')}">---</span></p>

        <!-- Like/Dislike -->
        <form th:action="@{/like}" method="post" style="display:inline;">
            <input type="hidden" name="commentId" th:value="${comment.id}" />
            <input type="hidden" name="movieId" th:value="${movie.id}" />
            <button type="submit">üëç <span th:text="${likesMap[comment.id]}">0</span></button>
        </form>
        <form th:action="@{/dislike}" method="post" style="display:inline;">
            <input type="hidden" name="commentId" th:value="${comment.id}" />
            <input type="hidden" name="movieId" th:value="${movie.id}" />
            <button type="submit">üëé <span th:text="${dislikesMap[comment.id]}">0</span></button>
        </form>

        <!-- Tr·∫£ l·ªùi b√¨nh lu·∫≠n -->
        <div th:if="${session.userLogin != null}">
            <button type="button" th:attr="onclick=|toggleReplyForm(${comment.id})|">Tr·∫£ l·ªùi</button>

            <form th:action="@{/replyComment}" method="post"
                  th:attr="id=|reply-form-${comment.id}|" style="display: none; margin-top: 10px;">
                <input type="hidden" name="movieId" th:value="${movie.id}" />
                <input type="hidden" name="parentCommentId" th:value="${comment.id}" />
                <textarea name="content" rows="2" cols="50" required placeholder="Tr·∫£ l·ªùi b√¨nh lu·∫≠n..."></textarea><br />
                <button type="submit">G·ª≠i tr·∫£ l·ªùi</button>
            </form>
        </div>


        <div th:if="${session.userLogin == null}">
            <p><i>ƒêƒÉng nh·∫≠p ƒë·ªÉ tr·∫£ l·ªùi b√¨nh lu·∫≠n.</i></p>
        </div>
        <!-- Danh s√°ch c√¢u tr·∫£ l·ªùi -->
        <div style="margin-left: 20px; margin-top: 10px;" th:each="reply : ${comment.replies}">
            <p><strong th:text="${reply.user.fullname}">Ng∆∞·ªùi tr·∫£ l·ªùi</strong>: <span th:text="${reply.content}">N·ªôi dung tr·∫£ l·ªùi</span></p>
            <p><i>Th·ªùi gian:</i> <span th:text="${#temporals.format(reply.createdAt, 'dd/MM/yyyy HH:mm')}">---</span></p>
        </div>
    </div>


    <!-- Hi·ªán l·ªói n·∫øu c√≥ -->
    <div th:if="${error}" class="error" th:text="${error}"></div>

    <a th:href="${movie.trailerUrl}" target="_blank">Xem Trailer</a>
    <br/>
    <a th:href="@{/movie-category}">Quay l·∫°i danh s√°ch phim</a>

</div>


<!-- prs footer Wrapper Start -->
<header lang="vi" th:include="fragments/footer"></header>
<!-- prs footer Wrapper End -->

<!-- Main JS Files -->
<script th:src="@{/js/jquery_min.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script th:src="@{/js/modernizr.js}"></script>
<script th:src="@{/js/owl.carousel.js}"></script>
<script th:src="@{/js/jquery.dlmenu.js}"></script>
<script th:src="@{/js/jquery.sticky.js}"></script>
<script th:src="@{/js/jquery.nice-select.min.js}"></script>
<script th:src="@{/js/jquery.magnific-popup.js}"></script>
<script th:src="@{/js/jquery.bxslider.min.js}"></script>
<script th:src="@{/js/venobox.min.js}"></script>
<script th:src="@{/js/smothscroll_part1.js}"></script>
<script th:src="@{/js/smothscroll_part2.js}"></script>
<script th:src="@{/js/jquery.countTo.js}"></script>
<script th:src="@{/js/jquery.inview.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/jquery.themepunch.revolution.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/jquery.themepunch.tools.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.addon.snow.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.actions.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.carousel.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.kenburn.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.layeranimation.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.migration.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.navigation.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.parallax.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.slideanims.min.js}"></script>
<script th:src="@{/js/plugin/rs_slider/revolution.extension.video.min.js}"></script>
<script th:src="@{/js/custom.js}"></script>
<script>
    function toggleReplyForm(commentId) {
        const form = document.getElementById('reply-form-' + commentId);
        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }
</script>

</body>

</html>